---
phase: "02"
plan: "02-05"
type: execute
wave: 2
depends_on: ["02-01", "02-02"]
files_modified:
  - "adaptive-tutor/src/app/(tabs)/chat/page.tsx"
  - "adaptive-tutor/src/app/(tabs)/graph/page.tsx"
  - "adaptive-tutor/src/app/layout.tsx"
  - "adaptive-tutor/src/lib/store.ts"
autonomous: false
must_haves:
  truths:
    - "Full end-to-end flow works: open Chat -> describe topic -> upload materials -> approve preview -> graph generates -> switch to Graph tab -> see colored DAG"
    - "App loads existing study plans on startup (page refresh doesn't lose data)"
    - "Lesson plan notification shows concept count and tier distribution after graph generation"
    - "Graph tab shows correct data immediately after switching from Chat tab"
  artifacts:
    - path: "adaptive-tutor/src/app/layout.tsx"
      provides: "App initialization that loads study plans on mount"
      contains: "loadStudyPlans"
  key_links:
    - from: "chat/page.tsx (done state)"
      to: "graph/page.tsx"
      via: "setActiveTab('graph') + activeStudyPlanId in Zustand"
      pattern: "setActiveTab.*graph"
    - from: "layout.tsx"
      to: "store.ts loadStudyPlans"
      via: "useEffect on mount"
      pattern: "loadStudyPlans"
---

# Phase 02-05: End-to-End Integration, App Init & Verification

## Objective

Wire together the Chat state machine (02-02), MiniMax graph generation (02-01), and React Flow visualization (02-03/02-04) into a working end-to-end flow. Add app initialization logic to load existing study plans on startup. Verify the complete user journey works.

Purpose: Individual plans built components in isolation. This plan ensures they compose correctly: the chat triggers generation, generation populates the store, and the graph renders. Without this integration, the pieces don't connect.

Output: A working demo flow from Chat tab to Graph tab, with data persistence across refreshes.

## Success Criteria

- [ ] App loads existing study plans on startup via `loadStudyPlans` in root layout
- [ ] Chat -> Graph flow works end-to-end: describe topic, get preview, approve, see graph
- [ ] `priorKnowledge` from chat's `collectedContext` is passed to generate-graph endpoint
- [ ] Lesson plan notification rendered in chat after generation (concept names grouped by tier)
- [ ] After generation: switching to Graph tab immediately shows the DAG (no extra loading needed)
- [ ] Page refresh on Graph tab reloads data from API (graph still visible)
- [ ] No console errors during the full flow
- [ ] Human verifies: graph renders with correct proficiency colors and layout

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-graph-generation-and-visualization/02-RESEARCH.md
@.planning/phases/02-graph-generation-and-visualization/02-01-SUMMARY.md
@.planning/phases/02-graph-generation-and-visualization/02-02-SUMMARY.md
@.planning/phases/02-graph-generation-and-visualization/02-03-SUMMARY.md
@.planning/phases/02-graph-generation-and-visualization/02-04-SUMMARY.md
@adaptive-tutor/src/app/(tabs)/chat/page.tsx
@adaptive-tutor/src/app/(tabs)/graph/page.tsx
@adaptive-tutor/src/app/layout.tsx
@adaptive-tutor/src/lib/store.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: App initialization + Chat-to-Graph data flow integration</name>
  <files>
    adaptive-tutor/src/app/layout.tsx
    adaptive-tutor/src/app/(tabs)/chat/page.tsx
    adaptive-tutor/src/lib/store.ts
  </files>
  <action>
  1. In root layout (`src/app/layout.tsx`): Add an initialization component or useEffect that calls `loadStudyPlans` on mount. Since layout.tsx might be a server component, create a small client component `AppInitializer`:
     ```typescript
     // Can be inline in layout.tsx or separate file
     "use client";
     import { useEffect } from "react";
     import { useAppStore } from "@/lib/store";

     export function AppInitializer() {
       const loadStudyPlans = useAppStore(state => state.loadStudyPlans);
       useEffect(() => { loadStudyPlans(); }, [loadStudyPlans]);
       return null;
     }
     ```
     Render `<AppInitializer />` inside the layout's body.

  2. In `chat/page.tsx`: Ensure the Chat-to-Graph handoff is correct:
     - When chat state machine reaches "generating" phase (after user approves preview):
       a. Create study plan: `POST /api/study-plans` with `{ title: collectedContext.topic, sourceText: collectedContext.sourceText }`
       b. Trigger generation: `POST /api/study-plans/[id]/generate-graph` with `{ priorKnowledge: collectedContext.priorKnowledge }` in the request body
       c. Parse response: extract `lessonPlan` from response to show in chat
       d. Load data into store: call `loadStudyPlanData(planId)` to populate conceptNodes, conceptEdges, and activeStudyPlanId
       e. Render lesson plan notification in chat: a styled card showing total concepts, concepts grouped by tier (Tier 1: Fundamentals, Tier 2: Intermediate, Tier 3: Advanced)
       f. Show "Your concept graph is ready!" message with a button to switch to Graph tab

     - Verify that `priorKnowledge` is correctly passed from the chat's `collectedContext` to the generate-graph API call. This is the key integration point that connects chat context gathering to proficiency inference.

  3. In `store.ts`: If `loadStudyPlanData` and `loadStudyPlans` actions were not yet added (from 02-04), add them now. If they exist, verify they work correctly by testing the data flow.

  4. Verify the tab switching mechanism: When user clicks "Switch to Graph tab" in chat:
     - `setActiveTab("graph")` is called
     - Confirm this actually navigates to the graph page (check if the app uses programmatic routing or if activeTab is used in the tab bar component to show/hide pages)
     - If the app uses Next.js routing (URL-based tabs), use `router.push("/graph")` instead of just setting store state
     - Check the existing tab layout component to understand the navigation pattern and match it

  5. Handle edge case: If user already has a study plan and creates a new one, the old plan's graph data should be replaced in the store. The `loadStudyPlanData` action should handle this (setting new activeStudyPlanId replaces old data).
  </action>
  <verify>
  - `npx tsc --noEmit` passes
  - App loads study plans on startup (check network tab for GET /api/study-plans on page load)
  - Chat creates study plan and generates graph
  - priorKnowledge passed to generate-graph endpoint (check request body in network tab)
  - Lesson plan notification shows in chat
  - Switching to Graph tab shows the DAG
  - Page refresh on Graph tab still shows the DAG
  </verify>
  <done>Full data flow connected: app init, chat context gathering, generation trigger with priorKnowledge, store hydration, graph rendering</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: End-to-end verification of Phase 02</name>
  <what-built>
    Complete Phase 02 integration: Chat-driven study plan creation, MiniMax graph generation, React Flow visualization with proficiency colors, node detail panel, and live updates.
  </what-built>
  <how-to-verify>
    1. Start the dev server: `cd adaptive-tutor && npm run dev`
    2. Open http://localhost:3000 in browser
    3. Go to Chat tab (should be default)
    4. Type a learning goal (e.g., "I want to learn machine learning fundamentals")
    5. Answer clarifying questions from the AI (prior knowledge, depth)
    6. Optionally: upload a .txt file with learning material
    7. Wait for concept preview to appear
    8. Approve the concept preview
    9. Wait for graph generation progress messages
    10. Click "Switch to Graph tab" (or navigate manually)
    11. Verify: DAG renders with nodes and edges
    12. Verify: Nodes have proficiency colors (not all gray if you stated prior knowledge)
    13. Verify: Edges render correctly (solid for prerequisite, dashed for helpful)
    14. Click a node: verify detail panel opens on the right
    15. Verify: Detail panel shows name, description, key terms, proficiency, prerequisites, dependents
    16. Click "Practice this concept" (should navigate to Learn tab -- actual practice is Phase 03)
    17. Test edit mode: click Edit, change a concept name, save, verify it updates
    18. Refresh the page: verify graph data persists (reloads from API)
    19. Check browser console: no errors during the entire flow

    Expected result: Full end-to-end flow works without errors. Graph is visually clear with colored nodes, proper layout, and interactive detail panel.
  </how-to-verify>
  <resume-signal>Type "approved" if the flow works, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. Full demo flow: Chat -> describe goal -> preview -> approve -> Graph tab shows DAG
2. Proficiency colors reflect stated prior knowledge
3. Node detail panel works with all features
4. Page refresh preserves graph data
5. No console errors
</verification>

<success_criteria>
- End-to-end flow works: Chat tab to Graph tab
- Data persists across page refreshes
- All Phase 02 requirements addressed: CHAT-01, CHAT-02, CHAT-03, GRAPH-01, GRAPH-02, GRAPH-03, GRAPH-05, VIZ-01, VIZ-02, VIZ-03
- Human approves the demo flow
</success_criteria>

<output>
After completion, create `.planning/phases/02-graph-generation-and-visualization/02-05-SUMMARY.md`
</output>
