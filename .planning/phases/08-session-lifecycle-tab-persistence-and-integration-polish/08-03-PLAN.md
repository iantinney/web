---
phase: 08-session-lifecycle-tab-persistence-and-integration-polish
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - adaptive-tutor/src/components/graph/NodeDetailPanel.tsx
autonomous: true
requirements: []

must_haves:
  truths:
    - "Clicking 'Practice this concept' in the Graph tab updates the chat context's active concept, so the chat tutor knows which concept the user is targeting"
  artifacts:
    - path: "adaptive-tutor/src/components/graph/NodeDetailPanel.tsx"
      provides: "chatContext.activeConceptId update on practice CTA click"
      contains: "activeConceptId"
  key_links:
    - from: "adaptive-tutor/src/components/graph/NodeDetailPanel.tsx"
      to: "useAppStore.getState().chatContext"
      via: "setChatContext call inside handlePractice"
      pattern: "setChatContext.*activeConceptId"
---

<objective>
Update NodeDetailPanel's "Practice this concept" button to also set chatContext.activeConceptId when clicked, so the chat tutor knows which concept the user is targeting from the graph.

Purpose: Phase 7 wired chatContext.activeConceptId for graph node clicks (onNodeClick in graph/page.tsx), but NodeDetailPanel's handlePractice function navigates to Learn without updating chatContext. This creates a gap — clicking a node updates chatContext, but clicking "Practice this" in the panel does not.

Output: Modified NodeDetailPanel.tsx where handlePractice sets chatContext.activeConceptId = concept.id before navigating.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-session-lifecycle-tab-persistence-and-integration-polish/08-RESEARCH.md
@adaptive-tutor/src/components/graph/NodeDetailPanel.tsx
@adaptive-tutor/src/lib/store.ts
@adaptive-tutor/src/app/(tabs)/graph/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update handlePractice to sync chatContext.activeConceptId</name>
  <files>adaptive-tutor/src/components/graph/NodeDetailPanel.tsx</files>
  <action>
    The `handlePractice` function (around lines 88-93) currently does:
    ```typescript
    function handlePractice() {
      useAppStore.getState().setTargetConceptId(concept.id);
      useAppStore.getState().setActiveTab("learn");
      router.push("/learn");
    }
    ```

    Add a chatContext update before the navigation call. The chatContext field already exists in Zustand (added in Phase 7, Plan 01). Read the current chatContext and spread it with the updated activeConceptId:

    ```typescript
    function handlePractice() {
      const store = useAppStore.getState();
      // Update chatContext so chat tutor knows which concept is being targeted
      store.setChatContext({
        ...store.chatContext,
        activeConceptId: concept.id,
      });
      store.setTargetConceptId(concept.id);
      store.setActiveTab("learn");
      router.push("/learn");
    }
    ```

    Verify that `setChatContext` is exposed on the store. From Phase 7 research: `setChatContext` is a store action that accepts a `Partial<ChatContext>` or full `ChatContext` object. Check store.ts to confirm the exact function signature and use it correctly.

    If `setChatContext` accepts a full `ChatContext` object (not partial), spread the existing chatContext:
    ```typescript
    store.setChatContext({ ...store.chatContext, activeConceptId: concept.id });
    ```

    If it accepts `Partial<ChatContext>`:
    ```typescript
    store.setChatContext({ activeConceptId: concept.id });
    ```

    Read store.ts to determine which signature is correct and use that form. Do NOT guess.

    No new imports are needed — `useAppStore` is already imported in NodeDetailPanel.tsx (it's used for `setTargetConceptId` and `setActiveTab`).
  </action>
  <verify>
    <automated>cd /Users/rykkim/Documents/githublocal/yale-agentic-ai-hackathon/adaptive-tutor && npx tsc --noEmit 2>&1 | head -30</automated>
    <manual>Click a concept node in the graph. Open NodeDetailPanel. Click "Practice this concept." Switch to Chat tab. Ask "What am I practicing?" The chat tutor should reference the concept you clicked, not a generic response.</manual>
  </verify>
  <done>TypeScript compiles clean. Clicking "Practice this concept" in NodeDetailPanel updates chatContext.activeConceptId to the concept's ID. The chat tutor correctly references this concept when asked about current practice context.</done>
</task>

</tasks>

<verification>
Run `cd /Users/rykkim/Documents/githublocal/yale-agentic-ai-hackathon/adaptive-tutor && npx tsc --noEmit` — must pass with 0 errors.

Functional check: Click a concept node, click "Practice this concept," switch to Chat tab. The advisor or chat context should reference the targeted concept by name.
</verification>

<success_criteria>
- Zero TypeScript compile errors
- handlePractice updates chatContext.activeConceptId before navigating to /learn
- Chat tutor's context is synchronized with the concept targeted from NodeDetailPanel
</success_criteria>

<output>
After completion, create `.planning/phases/08-session-lifecycle-tab-persistence-and-integration-polish/08-03-SUMMARY.md`
</output>
