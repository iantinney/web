---
phase: 10-fix-graph-edge-visibility-and-pulse-animation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - adaptive-tutor/src/app/(tabs)/graph/page.tsx
  - adaptive-tutor/src/components/graph/ParticleEdge.tsx
  - adaptive-tutor/src/app/globals.css
autonomous: false
requirements:
  - LAYOUT-02

must_haves:
  truths:
    - "Edges are clearly visible between nodes — neon green lines with flowing pulse dots"
    - "Edges render above unselected nodes but below selected/dragged nodes"
    - "Locked edges appear as dim dashed gray lines with no pulse animation"
    - "Pulse dot speed scales with source proficiency (slow at low, fast at high)"
    - "Edge style matches IntroAnimation neon green aesthetic (#00d2a0 with glow)"
    - "Hover focus effect still works — unrelated edges dim, connected edges stay bright"
  artifacts:
    - path: "adaptive-tutor/src/app/(tabs)/graph/page.tsx"
      provides: "zIndex: 1 on all edge objects in flowEdges useMemo"
      contains: "zIndex: 1"
    - path: "adaptive-tutor/src/components/graph/ParticleEdge.tsx"
      provides: "Neon green ParticleEdge matching IntroAnimation visual reference"
      contains: "rgba(0, 210, 160"
    - path: "adaptive-tutor/src/app/globals.css"
      provides: "particle-flow keyframe animation for stroke-dashoffset"
      contains: "@keyframes particle-flow"
  key_links:
    - from: "adaptive-tutor/src/app/(tabs)/graph/page.tsx"
      to: "adaptive-tutor/src/components/graph/ParticleEdge.tsx"
      via: "edgeTypes import + flowEdges data prop"
      pattern: "edgeTypes.*particle"
    - from: "adaptive-tutor/src/components/graph/ParticleEdge.tsx"
      to: "adaptive-tutor/src/app/globals.css"
      via: "CSS animation name reference"
      pattern: "particle-flow"
---

<objective>
Fix edge visibility bug and refine ParticleEdge visual style to match the IntroAnimation neon green aesthetic.

Purpose: Edges are currently invisible because React Flow renders edge SVGs at zIndex 0 (same as nodes), and nodes paint over them due to DOM order. This single-property fix (`zIndex: 1` on edge objects) makes edges visible, then ParticleEdge styling is refined to match the IntroAnimation's neon green glow with flowing dash-dot pulse animation.

Output: Visible, animated neon green edges flowing between concept nodes. Locked edges render as dim dashed gray. Pulse speed scales with proficiency.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-fix-graph-edge-visibility-and-pulse-animation/10-RESEARCH.md
@adaptive-tutor/src/app/(tabs)/graph/page.tsx
@adaptive-tutor/src/components/graph/ParticleEdge.tsx
@adaptive-tutor/src/components/IntroAnimation.tsx
@adaptive-tutor/src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add zIndex to edge objects and update graph page edge mapping</name>
  <files>adaptive-tutor/src/app/(tabs)/graph/page.tsx</files>
  <action>
In `graph/page.tsx`, add `zIndex: 1` as a top-level property on every edge object in the `flowEdges` useMemo (around line 129-140). This is the CORE FIX for visibility.

Specifically, in the `return` statement inside `graphEdges.map(...)`:
```typescript
return {
  id: edge.id,
  source: edge.fromNodeId,
  target: edge.toNodeId,
  type: "particle",
  zIndex: 1,  // <-- ADD THIS — renders edges above unselected nodes (zIndex 0)
  sourceHandle,
  targetHandle,
  data: {
    sourceProficiency,
    isLocked: targetLocked,
  },
};
```

Also update the comment block above the flowEdges useMemo (lines 97-100). Replace the current comment:
```
// All API edges with explicit handle selection per relative node position.
// Edges render in SVG below the HTML node layer, so they pass "under" nodes.
```
With:
```
// All API edges with explicit handle selection per relative node position.
// zIndex: 1 renders edges above unselected nodes (default zIndex 0) but below
// selected/dragged nodes (elevated to zIndex 1000+). See xyflow/xyflow#4729.
```

**Why this works:** React Flow v12 renders each edge as an individual `<svg style={{ zIndex }}>` and each node as a `<div style={{ zIndex }}>` within the same CSS stacking context. Default is 0 for both, but nodes paint over edges because they're later in DOM order. Setting edge zIndex to 1 makes them render above unselected nodes. Selected nodes get +1000, so edges correctly render below them.

**Why NOT style.zIndex:** The `style` object applies to elements INSIDE the edge SVG wrapper. Only the top-level `zIndex` property controls the wrapper's z-index.

The hover focus effect in the useEffect (lines 195-206) already preserves zIndex correctly via `...edge` spread, so no changes needed there.
  </action>
  <verify>
    <automated>cd adaptive-tutor && npx tsc --noEmit 2>&1 | head -20</automated>
    <manual>Open the graph page in browser — edges should now be clearly visible above node backgrounds</manual>
  </verify>
  <done>Every edge object in flowEdges has `zIndex: 1` as a top-level property. TypeScript compiles. Edges render above unselected nodes.</done>
</task>

<task type="auto">
  <name>Task 2: Refine ParticleEdge style to match IntroAnimation neon green aesthetic</name>
  <files>adaptive-tutor/src/components/graph/ParticleEdge.tsx, adaptive-tutor/src/app/globals.css</files>
  <action>
Rewrite the ParticleEdge component body to precisely match the IntroAnimation visual reference (IntroAnimation.tsx lines 128-183):

**Active edges (not locked):**

Base line (via BaseEdge):
- `stroke: "rgba(0, 210, 160, 0.3)"` — match IntroAnimation exactly
- `strokeWidth: 2` — match IntroAnimation exactly (current code has 1.5, bump to 2)
- `strokeLinecap: "round"` — match IntroAnimation

Pulse dots (via raw `<path>` overlay):
- `stroke: "rgba(0, 210, 160, 0.9)"` — bright green dots (already correct)
- `strokeWidth: 2.5` — slightly wider than base for visibility
- `strokeLinecap: "round"`
- `strokeDasharray: "4 22"` — 4px dot + 22px gap = 26px pattern (already correct)
- `animation: particle-flow ${duration}s linear infinite` — uses existing CSS keyframe
- `filter: "drop-shadow(0 0 6px rgba(0, 210, 160, 0.7))"` — neon glow (increase from current 4px/0.6 to 6px/0.7 for stronger glow matching IntroAnimation's stdDeviation=6 Gaussian blur)

Proficiency-scaled speed (already correct):
- `duration = 3 - proficiency * 1.8` — ranges from 3.0s (prof=0) to 1.2s (prof=1.0)

**Locked edges:**
- `stroke: "rgba(100, 100, 140, 0.15)"` — dim gray (already correct)
- `strokeWidth: 1` — thin (already correct)
- `strokeDasharray: "4 6"` — dashed pattern, no animation (already correct)

**Changes from current code:**
1. Base line strokeWidth: `1.5` → `2` (match IntroAnimation)
2. Base line stroke opacity: `0.35` → `0.3` (match IntroAnimation exactly: `rgba(0, 210, 160, 0.3)`)
3. Add `strokeLinecap: "round"` to base line style (match IntroAnimation)
4. Pulse glow filter: `drop-shadow(0 0 4px rgba(0, 210, 160, 0.6))` → `drop-shadow(0 0 6px rgba(0, 210, 160, 0.7))` (stronger neon glow)

**globals.css:** The `@keyframes particle-flow` is already correct (`to { stroke-dashoffset: -26; }` matches 4+22=26 dasharray total). No changes needed.

Do NOT change:
- The locked edge styling (already matches spec)
- The proficiency-scaled duration formula (already matches spec)
- The React.memo wrapper (already correct for performance)
- The getStraightPath usage (already correct)
  </action>
  <verify>
    <automated>cd adaptive-tutor && npx tsc --noEmit 2>&1 | head -20</automated>
    <manual>Open the graph page — edges should show neon green base lines with glowing animated dash-dots flowing along them. Locked edges should be dim dashed gray with no animation.</manual>
  </verify>
  <done>ParticleEdge base line uses stroke rgba(0,210,160,0.3) at strokeWidth 2 with round linecaps. Pulse dots have drop-shadow(0 0 6px rgba(0,210,160,0.7)) glow filter. Locked edges are dim dashed gray. Visual style matches IntroAnimation reference.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Visual verification of edge visibility and neon pulse animation</name>
  <action>
  Human verifies the visual output. Claude has already automated all code changes.

  **What was built:** Edge visibility fix (zIndex: 1) and ParticleEdge neon green styling matching IntroAnimation aesthetic.

  **How to verify:**
  1. Navigate to the Graph tab with an existing study plan
  2. Verify edges are clearly visible between nodes — neon green lines with flowing pulse dots
  3. Verify pulse dots have a neon glow effect (green drop-shadow visible around dots)
  4. Hover over a node — connected edges should stay bright, unrelated edges should dim
  5. Check locked concepts: edges leading to locked nodes should be dim dashed gray with no animation
  6. Click/select a node — the node should appear ABOVE edges (edges below selected node)
  7. Verify edge color matches the intro animation aesthetic (same neon green #00d2a0)
  </action>
  <verify>Human confirms visual output matches expectations</verify>
  <done>User approves the edge visibility and pulse animation visual style</done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `cd adaptive-tutor && npx tsc --noEmit` — no errors
2. Visual: Edges visible above node backgrounds in graph view
3. Visual: Neon green color (#00d2a0) matches IntroAnimation
4. Visual: Pulse dots flow along edges with glow effect
5. Visual: Locked edges are dim dashed gray, no pulse
6. Interaction: Hover focus effect still works (dim unrelated, highlight connected)
7. Interaction: Selected nodes render above edges
</verification>

<success_criteria>
- Edges are clearly visible in the graph — the primary bug is fixed
- Edge visual style matches IntroAnimation's neon green aesthetic
- Pulse animation flows along active edges with proficiency-scaled speed
- Locked edges render distinctly as dim dashed gray
- Hover focus interaction preserved — no regression
- No TypeScript compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/10-fix-graph-edge-visibility-and-pulse-animation/10-01-SUMMARY.md`
</output>
